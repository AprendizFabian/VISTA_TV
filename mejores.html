<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LUM ‚Äì Ranking Pickers</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --lum-yellow:#FFD60A;
  --lum-black:#414242;
  --lum-red:#FF5C5C;
}

/* RESET */
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:"Poppins",sans-serif;
  background:#f5f5f5;
  height:100vh;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
}

/* ===== CORNER DESIGN ===== */
.corner-black{
  position:absolute;top:0;left:0;
  border-left:260px solid var(--lum-black);
  border-bottom:210px solid transparent;
  z-index:3;
}
.corner-yellow{
  position:absolute;bottom:0;right:0;
  border-right:220px solid var(--lum-yellow);
  border-top:190px solid transparent;
  z-index:1;
}

/* ===== LOGO ===== */
.logo{
  position:absolute;
  top:20px;left:20px;
  width:90px;
  z-index:20;
  animation:floatLogo 3s ease-in-out infinite alternate;
  transition:transform 1s ease, opacity 1s ease;
}
@keyframes floatLogo{0%{transform:translateY(0);}100%{transform:translateY(6px);}}
.logo.hide{
  transform:scale(0) translate(-50%,-50%);
  opacity:0;
  position:fixed;
  top:50%;left:50%;
}

/* ===== LOADING ===== */
.carga{
  position:fixed;inset:0;
  background:white;
  display:flex;align-items:center;justify-content:center;
  z-index:3000;
  transition:opacity 1s ease;
}
.carga img{width:300px;}
.carga.oculta{opacity:0;pointer-events:none;}

/* Fade de salida */
.fade-overlay{
  position:fixed;inset:0;
  background:white;
  opacity:0;
  z-index:2500;
  pointer-events:none;
  transition:opacity 1.2s ease;
}
.fade-overlay.activo{opacity:1;}

/* ===== PANTALLAS ===== */
.pantalla{
  width:100%;
  max-width:1080px;
  display:none;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:18px;
  opacity:0;
  transform:translateY(20px);
  transition:opacity .7s ease,transform .7s ease;
  z-index:10;
}
.pantalla.visible{
  display:flex;
  opacity:1;
  transform:translateY(0);
}

/* ===== TITULOS ===== */
.title{
  font-size:46px;
  font-weight:700;
  text-align:center;
  color:var(--lum-yellow);
}
.subtitle{
  text-align:center;
  font-size:22px;
  color:#333;
}

/* ===== TABLA ===== */
.board{
  width:100%;
  background:white;
  border-radius:22px;
  padding:20px 25px;
  border:1px solid #ddd;
  box-shadow:0 12px 40px rgba(0,0,0,.15);
}

/* FILAS */
.row{
  display:grid;
  grid-template-columns: 75px 2fr 1.3fr 1.3fr 1fr;
  align-items:center;
  padding:18px 0;
  border-bottom:1px solid #eee;
  font-size:24px;
  opacity:0;
  transform:translateX(-20px);
  animation:slideIn .5s forwards;
}
.row:last-child{border-bottom:none;}

.row:nth-child(1){animation-delay:.1s;}
.row:nth-child(2){animation-delay:.2s;}
.row:nth-child(3){animation-delay:.3s;}
.row:nth-child(4){animation-delay:.4s;}
.row:nth-child(5){animation-delay:.5s;}

@keyframes slideIn{
  to{opacity:1;transform:translateX(0);}
}

/* ===== MEDALLAS ===== */
.medal{
  width:60px;height:60px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:26px;font-weight:700;
  border:3px solid white;
}

/* Mejores ‚Üí oro/plata/bronce */
.g1{background:#ffe27a;}
.g2{background:#e2e2e2;}
.g3{background:#f0b77f;}

/* Peores ‚Üí gris */
.gray-all .medal{
  background:#cfcfcf !important;
  color:#444;
}

/* ===== TEXTO ===== */
.picker{
  font-size:26px;font-weight:600;color:#111;
  white-space:nowrap;
}

.metric{
  display:flex;align-items:center;gap:10px;
}

.pill{
  padding:6px 14px;
  border-radius:999px;
  background:#eee;
  font-size:18px;
}

.bar{
  flex:1;
  height:14px;background:#eee;
  border-radius:999px;overflow:hidden;
  position:relative;
}
.bar i{
  position:absolute;left:0;top:0;bottom:0;width:0%;
  transition:width 1.2s ease;
}
.bar-ordenes i{background:#53d37a;}
.bar-tiempo i{background:#FFD60A;}
.bar-malo i{background:#FF5C5C;}

.tiny{
  width:65px;
  font-size:18px;
  font-weight:600;
  text-align:right;
}

/* ===== CONFETI (detr√°s) ===== */
#confetti{
  position:fixed; inset:0;
  pointer-events:none;
  z-index:2; 
}
</style>
</head>

<body>

<div class="fade-overlay" id="fadeOverlay"></div>
<div class="carga" id="pantallaCarga">
  <img src="img/carga.png">
</div>

<canvas id="confetti"></canvas>

<div class="corner-black"></div>
<div class="corner-yellow"></div>



<!-- ===== PANTALLA MEJORES ===== -->
<div class="pantalla" id="pantalla1">
  <h1 class="title">üèÜ Top 5 Pickers</h1>
  <p class="subtitle">M√°s √≥rdenes ¬∑ Mejor desempe√±o</p>
  <div class="board" id="boardMejores"></div>
</div>

<!-- ===== PANTALLA PEORES ===== -->
<div class="pantalla" id="pantalla2">
  <h1 class="title" style="color:var(--lum-red)">üìâ Oportunidades de mejora</h1>
  <p class="subtitle">Pickers con menor rendimiento</p>
  <div class="board gray-all" id="boardPeores"></div>
</div>

<script>
/* APIs */
const API_MEJORES="https://proxy-eight-taupe-93.vercel.app/api/topMejores.js";
const API_PEORES ="https://proxy-eight-taupe-93.vercel.app/api/topPeores.js";

/* ===== LEER TIENDA ===== */
const tienda = new URLSearchParams(window.location.search).get("tienda");

/* ===== CONFETI SOLO EN MEJORES ===== */
function confettiBoom(){
  const c=document.getElementById("confetti");
  const ctx=c.getContext("2d");
  c.width=innerWidth; c.height=innerHeight;

  const parts=[...Array(80)].map(()=>({
    x:Math.random()*c.width,
    y:Math.random()*-c.height,
    size:4+Math.random()*4,
    speed:1+Math.random()*2,
    col:`hsl(${40+Math.random()*60},100%,50%)`
  }));

  (function loop(){
    ctx.clearRect(0,0,c.width,c.height);
    for(const p of parts){
      ctx.fillStyle=p.col;
      ctx.fillRect(p.x,p.y,p.size,p.size);
      p.y+=p.speed;
      if(p.y>c.height) p.y=-10;
    }
    requestAnimationFrame(loop);
  })();
}

/* Utilidades */
const pick=(o,k)=>k.map(x=>o[x]).find(v=>v!=null);
const normalize=r=>r.map(a=>({
  picker:pick(a,["Picker","picker_name","picker"]),
  ordenes:+pick(a,["Ordenes","orders","count"]),
  tiempo:+pick(a,["InStoreTime","in_store"])
}));

/* Render */
function render(target,data,tipo){
  target.innerHTML=data.map((x,i)=>`
    <div class="row">
      <div class="medal ${["g1","g2","g3"][i]||"gx"}">${i+1}</div>
      <div class="picker">${x.picker}</div>
      <div class="metric">
        <span class="pill">√ìrdenes</span>
        <div class="bar bar-ordenes"><i></i></div>
        <span class="tiny">${x.ordenes}</span>
      </div>
      <div class="metric">
        <span class="pill">In-Store</span>
        <div class="bar ${tipo==="peor"?"bar-malo":"bar-tiempo"}"><i></i></div>
        <span class="tiny">${x.tiempo.toFixed(2)}m</span>
      </div>
      <div class="pill">Score: ${x.ordenes}</div>
    </div>
  `).join("");

  const maxOrd=Math.max(...data.map(d=>d.ordenes));
  const maxTime=Math.max(...data.map(d=>d.tiempo));

  requestAnimationFrame(()=>{
    [...target.querySelectorAll(".row")].forEach((row,i)=>{
      const d=data[i];
      row.querySelectorAll(".bar i")[0].style.width=(d.ordenes/maxOrd*100)+"%";
      row.querySelectorAll(".bar i")[1].style.width=(d.tiempo/maxTime*100)+"%";
    });
  });
}

/* ===== ANIMACI√ìN SALIDA ===== */
function animarSalida(){
  const logo=document.getElementById("logo");
  const fade=document.getElementById("fadeOverlay");

  logo.classList.add("hide");

  setTimeout(()=>{
    fade.classList.add("activo");
    setTimeout(()=>{
      window.location.href=`indicadores.html?tienda=${encodeURIComponent(tienda)}`;
    },1000);
  },900);
}

/* ===== FLUJO PRINCIPAL ===== */
async function init(){
  await new Promise(r=>setTimeout(r,4000));
  document.getElementById("pantallaCarga").classList.add("oculta");

  const r1=await fetch(API_MEJORES).then(r=>r.json());
  const r2=await fetch(API_PEORES).then(r=>r.json());

  const mejores=normalize(r1.query_result.data.rows);
  const peores =normalize(r2.query_result.data.rows);

  const p1=document.getElementById("pantalla1");
  const p2=document.getElementById("pantalla2");

  /* Mostrar pantalla 1 */
  p1.classList.add("visible");
  render(document.getElementById("boardMejores"),mejores,"mejor");
  confettiBoom();

  /* Cambio a pantalla 2 */
  setTimeout(()=>{
    document.getElementById("confetti").style.display="none";
    p1.classList.remove("visible");
    p2.classList.add("visible");
    render(document.getElementById("boardPeores"),peores,"peor");

    /* Salida ‚Üí indicadores */
    setTimeout(()=>{ animarSalida(); },9000);

  },11000);
}

init();
</script>


</body>
</html>
